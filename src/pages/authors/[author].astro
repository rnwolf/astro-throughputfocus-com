---
import BaseLayout from '$layouts/BaseLayout.astro';
import PostPreview from '$components/PostPreview.astro';
//import authorData from '../../data/authors.json';
import Config from "$/website.config.cjs";


export async function getStaticPaths() {
	const allPosts = await Astro.glob('../posts/*.md');
	let allAuthorsUnique = [...new Set(allPosts.map((p) => p.frontmatter.author))];
	return allAuthorsUnique.map((author) => ({ params: { author }, props: { allPosts } }));
}

const { allPosts } = Astro.props;
const title = 'Donâ€™s Blog';
const description = 'An example blog on Astro';

/** filter posts by author, sort by date */
const posts = allPosts.filter((post) => post.frontmatter.author === Astro.params.author).sort((a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf());
const author = authorData[posts[0].frontmatter.author];
---

<BaseLayout title="Throughput Focus home page" 
description="A description from the home page." 
metaDescription="This is a comprehensive description that is intented for the social media cards."
metaTitle="SEO title goes here and is different to the page title."
metaImage="default-opengraph-image.png"
metaImageAlt="System throughput is determined by system constraint.">

    <SiteBanner short="This is a short text" long="This is a long piece of text" link="/contact" />

	<p>{title}</p>
	<p>{description}</p> 
	<p>image={posts[0].frontmatter.image}</p> 
	<p>canonicalURL={Astro.canonicalURL.toString()} </p>

		<main class="wrapper">
			<h2 class="title">
				<div class="avatar"><img class="avatar-img" src={author.image} alt="" /></div>
				{author.name}
			</h2>
			{posts.map((post) => <PostPreview post={post} author={author} />)}
		</main>
</BaseLayout>
